<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Kod ile AR Küp</title>
    
    <!-- A-Frame kütüphanesi -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- AR.js MindAR kütüphanesi (Görüntü Takibi yerine Düzlem Takibi için) -->
    <script src="https://cdn.jsdelivr.net/npm/mindar-image@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mindar-image@1.2.2/dist/mindar-image.prod.js"></script>

    <style>
        /* CSS stil kodları (Minimal yükleme ekranı ve genel görünüm) */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; }
        
        /* AR Yükleyici Ekranı */
        .arjs-loader {
            height: 100%; width: 100%; position: absolute; top: 0; left: 0;
            background-color: rgba(0, 0, 0, 0.85); z-index: 9999; 
            display: flex; justify-content: center; align-items: center;
        }
        .arjs-loader div {
            text-align: center; font-size: 1.25em; color: white;
            padding: 20px 40px; border-radius: 10px; background: #1f2937;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        /* Bilgi Mesaj Kutusu */
        #message-box {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #4a5568; color: white; padding: 10px 20px;
            border-radius: 8px; z-index: 1000; font-size: 0.9em;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Yükleme Ekranı -->
    <div class="arjs-loader">
        <div>Kamera izni istendi. Düz bir yüzeye (zemin/masa) odaklanın.</div>
    </div>

    <!-- Bilgi Mesaj Kutusu -->
    <div id="message-box">Ekranın herhangi bir yerine dokunarak küpü yerleştirin.</div>

    <a-scene 
        mindar-image="imageTargetSrc: ; filterMinCF:0.0001; filterBeta: 0.0001;" 
        arjs="sourceType: webcam; debugUIEnabled: false;"
        vr-mode-ui="enabled: false"
        renderer="antialias: true; precision: medium;"
        id="scene">

        <!-- AR Kontrol Ayarları (Düzlem Tespiti için) -->
        <a-entity mindar-image-target="targetIndex: 0" id="target">
            <!-- Bu hedef kısmı AR.js'in düzlem takibi için kullanılıyor, bir model konulmayacak -->
        </a-entity>

        <!-- Kamera -->
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    </a-scene>

    <script>
        const sceneEl = document.getElementById('scene');
        const messageBox = document.getElementById('message-box');

        // Kullanıcı ekrana dokunduğunda çalışacak fonksiyon
        sceneEl.addEventListener('click', (event) => {
            // Işın atma (Raycasting) için gerekli bileşenleri al
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();

            // Ekran koordinatlarını normalleştir
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            // Kamerayı al
            const camera = sceneEl.camera.el.getObject3D('camera');
            if (!camera) {
                 console.error("Kamera objesi bulunamadı.");
                 messageBox.textContent = "Hata: Kamera başlatılamadı.";
                 return;
            }

            raycaster.setFromCamera(mouse, camera);

            // MindAR'ın düzlem tespiti için kullandığı 'THREE.ARUtils.currentTrackingPlane' benzeri bir yapı
            // veya temel düzlem objesini kullanmak gerekir. 
            // Basitlik için, küpü doğrudan kamera önündeki varsayılan bir noktaya yerleştirelim
            // veya MindAR'ın kendi düzlem tespiti olayını kullanalım.

            // MindAR'ın yerleştirme API'si kullanılamayacağından, 
            // A-Frame'in temel raycasting mekanizmasını kullanarak kamera önündeki bir noktayı hedefleyelim.
            // Bu, düzlem tespiti olmadan basit bir yerleşim sağlar.

            // Kamera konumu ve yönüne göre 1.5 metre ilerideki bir noktayı hesapla
            const position = new THREE.Vector3();
            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            position.copy(camera.position).add(direction.multiplyScalar(1.5)); // 1.5 metre ileri

            // Yeni küpü oluştur
            const newCube = document.createElement('a-box');
            
            // Küp niteliklerini ayarla (Tailwind sınıfları yerine A-Frame nitelikleri)
            newCube.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            newCube.setAttribute('rotation', '0 45 0');
            newCube.setAttribute('width', '0.2');
            newCube.setAttribute('height', '0.2');
            newCube.setAttribute('depth', '0.2');
            newCube.setAttribute('color', '#EF4444'); /* Kırmızı renk */
            newCube.setAttribute('shadow', '');
            
            // Animasyon ekle (isteğe bağlı)
            newCube.setAttribute('animation', {
                property: 'rotation',
                to: '0 405 0',
                dur: 10000,
                easing: 'linear',
                loop: true
            });

            // Küpü sahneye ekle
            sceneEl.appendChild(newCube);

            messageBox.textContent = "3D Küp yerleştirildi! Tekrar dokunarak yenisini ekleyin.";
        });
        
        // A-Frame yüklendiğinde yükleyiciyi gizle
        sceneEl.addEventListener('loaded', () => {
            document.querySelector('.arjs-loader').style.display = 'none';
        });

    </script>
</body>
</html>
